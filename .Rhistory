df_w3_comb_data <- df_w3_comb_data %>%
filter(altrelucat=="Student")
# impute missing alter relig in cases where
# 1) the alter was reported by multiple egos
# 2) at least one ego attributed a relig to that alter
# 3) only one other relig was attributed to that alter
# This preserves 100 ties from being deleted
df_w3_comb_data <- df_w3_comb_data %>%
mutate(dupe_alter=
duplicated(df_w3_comb_data["alterid"]))
df_alter_dupes <- df_w3_comb_data %>%
filter(dupe_alter == TRUE)
list_alter_dupes <- unique(df_alter_dupes$alterid)
df_alter_dupes <- df_w3_comb_data %>%
filter(alterid %in% list_alter_dupes)
df_alter_dupes <- df_alter_dupes %>%
group_by(alterid) %>%
mutate(n_rels = n_distinct(altrelig))
df_alter_dupes <- df_alter_dupes %>%
filter(n_rels == 2)
list_na_alter <- df_alter_dupes %>%
filter(is.na(altrelig))
list_na_alter <- list_na_alter$alterid
df_alter_dupes <- df_alter_dupes %>%
filter(alterid %in% list_na_alter)
df_alter_dupes <- df_alter_dupes %>%
group_by(alterid) %>%
mutate(altrelig = unique(altrelig[!is.na(altrelig)]))
df_imputed_alts <- df_alter_dupes %>%
select(alterid, altrelig)
df_imputed_alts <- distinct(df_imputed_alts)
View(df_alter_dupes)
View(df_w3_comb_data)
View(df_imputed_alts)
df_imputed_alts <- rename(df_imputed_alts, altrelig_i = altrelig)
View(df_imputed_alts)
df_w3_comb_data <- left_join(df_w3_comb_data, df_imputed_alts, by = alterid)
df_w3_comb_data <- left_join(df_w3_comb_data, df_imputed_alts, by = "alterid")
View(df_w3_comb_data)
df_w3_comb_data$altrelig <- ifelse(is.na(df_w3_comb_data$altrelig), df_w3_comb_data$altrelig_i, df_w3_comb_data$altrelig)
test <- df_w3_comb_data %>%
select(egoid, alterid, altrelig, altrelig_i)
View(test)
View(df_alter_dupes)
# filter out altrelig == NA
df_w3_comb_data <- df_w3_comb_data |>
filter(!is.na(altrelig))
# load ego network survey
df_netsurv <- read_csv(here('data', 'NetWorkSurvey(2-28-20).csv'))
# load basic survey
df_basicsurv <- read_csv(here('data', 'BasicSurvey(3-6-20).csv'))
# subset the network dataframes to W3
df_netsurv <- df_netsurv |>
filter(wave == 'Wave3')
df_w3_comb_data <- left_join(df_basicsurv, df_netsurv, by = 'egoid')
# filter out yourelig == NA
df_w3_comb_data <- df_w3_comb_data |>
filter(!is.na(yourelig_1))
# subset to on-campus ties
df_w3_comb_data <- df_w3_comb_data %>%
filter(altrelucat=="Student")
# filter out altrelig == NA
df_w3_comb_data <- df_w3_comb_data |>
filter(!is.na(altrelig))
2132-2024
# load ego network survey
df_netsurv <- read_csv(here('data', 'NetWorkSurvey(2-28-20).csv'))
# load basic survey
df_basicsurv <- read_csv(here('data', 'BasicSurvey(3-6-20).csv'))
# subset the network dataframes to W3
df_netsurv <- df_netsurv |>
filter(wave == 'Wave3')
df_w3_comb_data <- left_join(df_basicsurv, df_netsurv, by = 'egoid')
# filter out yourelig == NA
df_w3_comb_data <- df_w3_comb_data |>
filter(!is.na(yourelig_1))
# subset to on-campus ties
df_w3_comb_data <- df_w3_comb_data %>%
filter(altrelucat=="Student")
# impute missing alter relig in cases where
# 1) the alter was reported by multiple egos
# 2) at least one ego attributed a relig to that alter
# 3) only one other relig was attributed to that alter
# This preserves 108 ties from being deleted
df_w3_comb_data <- df_w3_comb_data %>%
mutate(dupe_alter=
duplicated(df_w3_comb_data["alterid"]))
df_alter_dupes <- df_w3_comb_data %>%
filter(dupe_alter == TRUE)
list_alter_dupes <- unique(df_alter_dupes$alterid)
df_alter_dupes <- df_w3_comb_data %>%
filter(alterid %in% list_alter_dupes)
df_alter_dupes <- df_alter_dupes %>%
group_by(alterid) %>%
mutate(n_rels = n_distinct(altrelig))
df_alter_dupes <- df_alter_dupes %>%
filter(n_rels == 2)
list_na_alter <- df_alter_dupes %>%
filter(is.na(altrelig))
list_na_alter <- list_na_alter$alterid
df_alter_dupes <- df_alter_dupes %>%
filter(alterid %in% list_na_alter)
df_alter_dupes <- df_alter_dupes %>%
group_by(alterid) %>%
mutate(altrelig = unique(altrelig[!is.na(altrelig)]))
df_imputed_alts <- df_alter_dupes %>%
select(alterid, altrelig)
df_imputed_alts <- distinct(df_imputed_alts)
df_imputed_alts <- rename(df_imputed_alts, altrelig_i = altrelig)
df_w3_comb_data <- left_join(df_w3_comb_data, df_imputed_alts, by = "alterid")
df_w3_comb_data$altrelig <- ifelse(is.na(df_w3_comb_data$altrelig), df_w3_comb_data$altrelig_i, df_w3_comb_data$altrelig)
test <- df_w3_comb_data %>%
select(egoid, alterid, altrelig, altrelig_i)
# filter out altrelig == NA
df_w3_comb_data <- df_w3_comb_data |>
filter(!is.na(altrelig))
View(test)
rm(test)
rm(df_imputed_alts, df_alter_dupes, list_alter_dupes, list_na_alter)
# create same-relig variable
df_w3_comb_data <- df_w3_comb_data |>
mutate(
same_relig = case_when(
yourelig_1 == "Catholic" & altrelig == "Catholic" ~ 1,
yourelig_1 == "No Religion" & altrelig == "NoReligion" ~ 1,
yourelig_1 == "Other Religion" & altrelig == "OtherReligion" ~ 1,
yourelig_1 == "Protestant" & altrelig == "Protestant" ~ 1,
TRUE ~ 0
))
# count the number of same-relig alters
df_w3_comb_data <- df_w3_comb_data |>
group_by(egoid) %>%
mutate(n_samerelig = sum(same_relig == 1))
#count the degree
df_w3_comb_data <- df_w3_comb_data |>
group_by(egoid) %>%
mutate(degree = n())
# count the number of diff-relig alters
df_w3_comb_data <- df_w3_comb_data |>
group_by(egoid) %>%
mutate(n_diffrelig = degree-n_samerelig)
# calculate EI Index
df_w3_comb_data <- df_w3_comb_data |>
group_by(egoid) |>
mutate(ei = (n_diffrelig-n_samerelig)/(degree))
#create vars for the denominators
table(df_basicsurv$yourelig_1)
e_cath <- 89+33+71
i_cath <- 525-1
e_none <- 525+33+71
i_none <- 89-1
e_other<- 525+89+71
i_other<- 33-1
e_prot <- 525+89+33
i_prot <- 71-1
df_w3_comb_data <- df_w3_comb_data %>%
mutate(
e_denominator = case_when(
yourelig_1 == "Catholic" ~ e_cath,
yourelig_1 == "No Religion" ~ e_none,
yourelig_1 == "Other Religion" ~ e_other,
yourelig_1 == "Protestant" ~ e_prot,
TRUE ~ 0
))
df_w3_comb_data <- df_w3_comb_data %>%
mutate(
i_denominator = case_when(
yourelig_1 == "Catholic" ~ i_cath,
yourelig_1 == "No Religion" ~ i_none,
yourelig_1 == "Other Religion" ~ i_other,
yourelig_1 == "Protestant" ~ i_prot,
TRUE ~ 0
))
# calculate EI Index
df_w3_comb_data <- df_w3_comb_data |>
group_by(egoid) |>
mutate(ei_norm =
((n_diffrelig/e_denominator)-(n_samerelig/i_denominator))/((n_diffrelig/e_denominator)+(n_samerelig/i_denominator)))
df_w3_model_data <- df_w3_comb_data |>
select(egoid, yourelig_1, degree, ei, ei_norm, n_samerelig)
df_w3_model_data <- distinct(df_w3_model_data)
model <- lm(ei_norm ~ yourelig_1 + degree, df_w3_model_data)
summary(model)
df_w3_model_data %>%
group_by(yourelig_1) %>%
summarise_at(vars(ei_norm), list(name = mean))
prop.table(table(df_w3_comb_data$altrelig))
#Copy the observed df and subset. We copy to preserve the degree, then we
#randomize the alter's religious identity
df_simulated <- df_w3_comb_data
df_simulated <- df_simulated %>%
select(egoid, yourelig_1, alterid, altrelig, e_denominator, i_denominator)
#Set the choices of religious identities
table(df_simulated$altrelig)
religions <- c("Catholic", "NoReligion", "OtherReligion", "Protestant")
#Set weights equal to the distribution of religious identities
prop.table(table(df_basicsurv$yourelig_1))
weights <- c(0.73119777, 0.12395543, 0.04596100, 0.09888579)
#Set size equal to the length of the df
size = nrow(df_simulated)
#Replace altrelig with a weighted random sample
weighted_sample <- sample(religions, size = size, prob = weights, replace = TRUE)
df_simulated$altrelig <- weighted_sample
df_simulated <- df_simulated %>%
mutate(
same_relig = case_when(
yourelig_1 == "Catholic" & altrelig == "Catholic" ~ 1,
yourelig_1 == "No Religion" & altrelig == "NoReligion" ~ 1,
yourelig_1 == "Other Religion" & altrelig == "OtherReligion" ~ 1,
yourelig_1 == "Protestant" & altrelig == "Protestant" ~ 1,
TRUE ~ 0
))
# count the number of same-relig alters
df_simulated <- df_simulated %>%
group_by(egoid) %>%
mutate(n_samerelig = sum(same_relig == 1))
#count the degree
df_simulated <- df_simulated %>%
group_by(egoid) %>%
mutate(degree = n())
# count the number of diff-relig alters
df_simulated <- df_simulated %>%
group_by(egoid) %>%
mutate(n_diffrelig = degree-n_samerelig)
# calculate normalized ei
df_simulated <- df_simulated %>%
group_by(egoid) %>%
mutate(ei_norm =
((n_diffrelig/e_denominator)-(n_samerelig/i_denominator))/((n_diffrelig/e_denominator)+(n_samerelig/i_denominator)))
df_simulated_sub <- df_simulated |>
select(egoid, yourelig_1, degree, ei_norm, n_samerelig)
df_simulated_sub <- distinct(df_simulated_sub)
df_simulated_sub %>%
group_by(yourelig_1) %>%
summarise_at(vars(ei_norm), list(name = mean))
# calculate EI Index
df_simulated <- df_simulated |>
group_by(egoid) |>
mutate(ei = (n_diffrelig-n_samerelig)/(degree))
df_simulated_sub <- df_simulated |>
select(egoid, yourelig_1, degree, ei_norm, n_samerelig)
df_simulated_sub <- distinct(df_simulated_sub)
# check mean ei by group
df_simulated_sub %>%
group_by(yourelig_1) %>%
summarise_at(vars(ei), list(name = mean))
df_simulated_sub <- df_simulated |>
select(egoid, yourelig_1, degree, ei_norm, ei, n_samerelig)
df_simulated_sub <- distinct(df_simulated_sub)
# check mean ei by group
df_simulated_sub %>%
group_by(yourelig_1) %>%
summarise_at(vars(ei), list(name = mean))
df_w3_model_data %>%
group_by(yourelig_1) %>%
summarise_at(vars(ei), list(name = mean))
-0.622 + 0.458
0.529 - .715
prop.table(table(df_catholic$altrelig))
prop.table(table(df_w3_model_data$yourelig_1))
#compare altrelig distribution for each group
df_w3_sub <- df_w3_comb_data %>%
select(egoid, alterid, yourelig_1, altrelig)
df_w3_sub %>%
group_by(yourelig_1) %>%
prop.table(table(altrelig))
df_w3_sub %>%
group_by(yourelig_1) %>%
prop.table(table(df_w3$altrelig))
df_w3_sub %>%
group_by(yourelig_1) %>%
prop.table(table(df_w3_sub$altrelig))
df_catholic <- df_w3_sub %>%
filter(yourelig_1 == "Catholic")
prop.table(table(df_catholic$altrelig))
df_norelig <- df_w3_sub %>%
filter(yourelig_1 == "NoReligion")
prop.table(table(df_norelig$altrelig))
df_norelig <- df_w3_sub %>%
filter(yourelig_1 == "No Religion")
prop.table(table(df_norelig$altrelig))
prop.table(table(df_simulated$altrelig))
df_othrelig <- df_w3_sub %>%
filter(yourelig_1 == "Other Religion")
prop.table(table(df_othrelig$altrelig))
df_prot <- df_w3_sub %>%
filter(yourelig_1 == "Protestant")
prop.table(table(df_prot$altrelig))
prop.table(table(df_catholic$altrelig))
prop.table(table(df_norelig$altrelig))
prop.table(table(df_othrelig$altrelig))
prop.table(table(df_prot$altrelig))
prop.table(table(df_basicsurv$yourelig_1))
baseline_df <- prop.table(table(df_basicsurv$yourelig_1))
baseline_df <- as.dataframe(prop.table(table(df_basicsurv$yourelig_1)))
baseline_df <- as.data.frame(prop.table(table(df_basicsurv$yourelig_1)))
View(baseline_df)
baseline_df <- as.data.frame(prop.table(table(df_basicsurv$yourelig_1)), col.names = ("altrelig","baseline_perc"))
baseline_df <- as.data.frame(prop.table(table(df_basicsurv$yourelig_1)), col.names = c("altrelig","baseline_perc"))
View(baseline_df)
rm(baseline_df)
baseline_df <- as.data.frame(prop.table(table(df_basicsurv$yourelig_1)), col.names = c("altrelig","baseline_perc"))
View(baseline_df)
baseline_df <- as.data.frame(prop.table(table(df_basicsurv$yourelig_1)))
rm(baseline_df)
baseline_df <- as.data.frame(prop.table(table(df_basicsurv$yourelig_1)))
View(baseline_df)
View(baseline_df)
baseline_df <- rename(baseline_df, Var1 = altrelig, Freq = baseline_perc)
baseline_df <- rename(baseline_df, altrelig = Var1, baseline_perc = Freq)
View(baseline_df)
df_cath_alters_perc <- as.data.frame(prop.table(table(df_catholic$altrelig)))
df_cath_alters_perc <- rename(df_cath_alters_perc, altrelig = Var1, cath_perc = Freq)
View(df_cath_alters_perc)
df_norelig_alters_perc <- as.data.frame(prop.table(table(df_norelig$altrelig)))
df_norelig_alters_perc <- rename(df_norelig_alters_perc, altrelig = Var1, norelig_perc = Freq)
df_othrelig_alters_perc <- as.data.frame(prop.table(table(df_othrelig$altrelig)))
df_othrelig_alters_perc <- rename(df_othrelig_alters_perc, altrelig = Var1, othrelig_perc = Freq)
df_prot_alters_perc <- as.data.frame(prop.table(table(df_prot$altrelig)))
df_prot_alters_perc <- rename(df_prot_alters_perc, altrelig = Var1, prot_perc = Freq)
df_alters_relig_perc <- left_join(baseline_df, df_cath_alters_perc)
df_alters_relig_perc <- left_join(df_alters_relig_perc, df_norelig_alters_perc)
df_alters_relig_perc <- left_join(df_alters_relig_perc, df_othrelig_alters_perc)
df_alters_relig_perc <- left_join(df_alters_relig_perc, df_prot_alters_perc)
View(df_alters_relig_perc)
View(df_cath_alters_perc)
df_alters_relig_perc <- left_join(baseline_df, df_cath_alters_perc)
View(df_alters_relig_perc)
df_cath_alters_perc
library(plyr)
baseline_df$altrelig <- revalue(baseline_df$altrelig, c("No Religion" = "NoReligion", "Other Religion" = "OtherReligion"))
View(baseline_df)
df_alters_relig_perc <- left_join(baseline_df, df_cath_alters_perc)
View(baseline_df)
df_alters_relig_perc <- left_join(baseline_df, df_cath_alters_perc)
View(baseline_df)
rm(df_alters_relig_perc)
df_alters_relig_perc <- left_join(baseline_df, df_cath_alters_perc)
View(df_alters_relig_perc)
df_alters_relig_perc <- left_join(df_alters_relig_perc, df_norelig_alters_perc)
df_alters_relig_perc <- left_join(df_alters_relig_perc, df_othrelig_alters_perc)
df_alters_relig_perc <- left_join(df_alters_relig_perc, df_prot_alters_perc)
View(df_alters_relig_perc)
df_alters_relig_perc$cath_diff <- df_alters_relig_perc$cath_perc - df_alters_relig_perc$baseline_perc
View(df_alters_relig_perc)
df_alters_relig_perc$none_diff <- df_alters_relig_perc$norelig_perc - df_alters_relig_perc$baseline_perc
View(df_alters_relig_perc)
df_alters_relig_perc$other_diff <- df_alters_relig_perc$othrelig_perc - df_alters_relig_perc$baseline_perc
df_alters_relig_perc$prot_diff <- df_alters_relig_perc$prot_perc - df_alters_relig_perc$baseline_perc
View(df_alters_relig_perc)
df_sub <- df_alters_relig_perc %>%
select(altrelig, baseline_perc, cath_diff, none_diff, other_diff, prot_diff)
View(df_sub)
df_w3_model_data %>%
group_by(yourelig_1) %>%
summarise_at(vars(degree), list(name = mean))
library(ggplot2)
ggplot(df_sub, aes(x = altrelig, y = cath_diff)) +
geom_bar(stat = "identity",
show.legend = FALSE) + # Remove the legend
xlab("Group") +
ylab("Value")
ggplot(df_sub, aes(x = altrelig, y = cath_diff)) +
geom_bar(stat = "identity",
show.legend = FALSE) + # Remove the legend
xlab("Group") +
ylab("Value")+
coord_flip()
df_sub_long <- df_sub
df_sub_long <- df_sub_long %>%
select(-baseline_perc)
df_sub_long <- gather(df_sub_long)
View(df_sub_long)
View(df_sub_long)
View(df_sub_long)
df_sub_long <- gather(df_sub_long,key = "ego_relig", value = "diffrence", -altrelig)
df_sub_long <- df_sub
df_sub_long <- df_sub_long %>%
select(-baseline_perc)
df_sub_long <- gather(df_sub_long,key = "ego_relig", value = "diffrence", -altrelig)
View(df_sub_long)
df_sub_long <- df_sub
df_sub_long <- df_sub_long %>%
select(-baseline_perc)
df_sub_long <- gather(df_sub_long,key = "ego_relig", value = "difference", -altrelig)
p <- ggplot(df_sub_long, aes(x = altrelig, y = difference))+
geom_bar(stat = "identity",
show.legend = FALSE)+
coord_flip()
p + facet_grid(rows = vars(ego_relig))
p + facet_grid(cols = vars(ego_relig))
p + facet_grid(rows = vars(ego_relig))
p <- ggplot(df_sub_long, aes(x = altrelig, y = difference))+
geom_bar(stat = "identity",
show.legend = FALSE)+
coord_flip()+
xlab("Alter's Religion")+
ylab("Preference toward group beyond expected")
p + facet_grid(rows = vars(ego_relig))
df_sub_long$difference <- as.factor(df_sub_long$difference)
df_sub_long$difference <- revalue(df_sub_long$difference, c("cath_diff" = "Catholic Egos",
"none_diff" = "No Relig Egos",
"other_diff"= "Other Relig Egos",
"prot_diff" = "Protestant Egos"))
df_sub_long$difference
df_sub_long <- df_sub
df_sub_long <- df_sub_long %>%
select(-baseline_perc)
df_sub_long <- gather(df_sub_long,key = "ego_relig", value = "difference", -altrelig)
df_sub_long$ego_relig <- as.factor(df_sub_long$ego_relig)
df_sub_long$ego_relig <- revalue(df_sub_long$ego_relig, c("cath_diff" = "Catholic Egos",
"none_diff" = "No Relig Egos",
"other_diff"= "Other Relig Egos",
"prot_diff" = "Protestant Egos"))
p <- ggplot(df_sub_long, aes(x = altrelig, y = difference))+
geom_bar(stat = "identity",
show.legend = FALSE)+
coord_flip()+
xlab("Alter's Religion")+
ylab("Preference toward group beyond expected")
p + facet_grid(rows = vars(ego_relig))
model <- lm(ei_norm ~ yourelig_1, df_simulated_sub)
summary(model)
df_simulated_sub %>%
group_by(yourelig_1) %>%
summarise_at(vars(ei_norm), list(name = mean))
df_simulated_sub %>%
group_by(yourelig_1) %>%
summarise_at(vars(ei), list(name = mean))
df_w3_model_data %>%
group_by(yourelig_1) %>%
summarise_at(vars(ei), list(name = mean))
.622-.458
df_w3_model_data %>%
group_by(yourelig_1) %>%
summarise_at(vars(ei_norm), list(name = mean))
prop.table(table(df_w3_model_data$yourelig_1))
prop.table(table(df_basicsurv$yourelig_1))
(table(df_w3_model_data$yourelig_1)
table(df_w3_model_data$yourelig_1)
table(df_basicsurv$yourelig_1)
#Function to create many simulations and aggregate the average EI Indices for each group
get_simulated_avg_ei <- function(df){}
#Function to create many simulations and aggregate the average EI Indices for each group
get_simulated_avg_ei <- function(data){
data <- df
}
#Function to create many simulations and aggregate the average EI Indices for each group
get_simulated_avg_ei <- function(data){
df <- data
}
#Function to create many simulations and aggregate the average EI Indices for each group
get_simulated_ei <- function(data){
df_simulated <- data
df_simulated <- df_simulated %>%
select(egoid, yourelig_1, alterid, altrelig, e_denominator, i_denominator)
#Set the choices of religious identities
religions <- c("Catholic", "NoReligion", "OtherReligion", "Protestant")
#Set weights equal to the distribution of religious identities
weights <- c(0.73119777, 0.12395543, 0.04596100, 0.09888579)
#Set size equal to the length of the df
size = nrow(df_simulated)
#Replace altrelig with a weighted random sample
weighted_sample <- sample(religions, size = size, prob = weights, replace = TRUE)
df_simulated$altrelig <- weighted_sample
df_simulated <- df_simulated %>%
mutate(
same_relig = case_when(
yourelig_1 == "Catholic" & altrelig == "Catholic" ~ 1,
yourelig_1 == "No Religion" & altrelig == "NoReligion" ~ 1,
yourelig_1 == "Other Religion" & altrelig == "OtherReligion" ~ 1,
yourelig_1 == "Protestant" & altrelig == "Protestant" ~ 1,
TRUE ~ 0
))
# count the number of same-relig alters
df_simulated <- df_simulated %>%
group_by(egoid) %>%
mutate(n_samerelig = sum(same_relig == 1))
#count the degree
df_simulated <- df_simulated %>%
group_by(egoid) %>%
mutate(degree = n())
# count the number of diff-relig alters
df_simulated <- df_simulated %>%
group_by(egoid) %>%
mutate(n_diffrelig = degree-n_samerelig)
# calculate EI Index
df_simulated <- df_simulated |>
group_by(egoid) |>
mutate(ei = (n_diffrelig-n_samerelig)/(degree))
#subset and return
df_simulated_sub <- df_simulated |>
select(egoid, yourelig_1, ei)
df_simulated_sub <- distinct(df_simulated_sub)
return(df_simulated_sub)
}
test_df <- get_simulated_ei(df_w3_comb_data)
rlang::last_trace()
library(here)
library(readr)
library(dplyr)
# load ego network survey
df_netsurv <- read_csv(here('data', 'NetWorkSurvey(2-28-20).csv'))
# load basic survey
df_basicsurv <- read_csv(here('data', 'BasicSurvey(3-6-20).csv'))
# load ego network survey
df_netsurv <- read_csv(here('data', 'NetWorkSurvey(2-28-20).csv'))
library(here)
library(readr)
library(dplyr)
# load ego network survey
df_netsurv <- read_csv(here('data', 'NetWorkSurvey(2-28-20).csv'))
