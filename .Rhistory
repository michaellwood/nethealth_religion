geom_hline(yintercept = 0)
z_cath <- (-0.622 + 0.460)/0.0284
z_none <- (0.529 - 0.756)/0.0638
z_other<- (0.698 - 0.909)/0.0604
z_prot <- (0.583 - 0.805)/0.0508
df_w3_model_data <- df_w3_comb_data |>
select(egoid, yourelig_1, degree, ei, ei_norm, n_samerelig, gender_1, race_1)
df_w3_model_data <- distinct(df_w3_model_data)
library(here)
library(dplyr)
library(jtools)
model <- lm(ei_norm ~ yourelig_1 + degree + gender_1 + race_1, df_w3_model_data)
summary(model)
model <- lm(ei_norm ~ yourelig_1 + degree + gender_1, df_w3_model_data)
summary(model)
summ(model)
export_summs(model)
install.packages("huxtable")
export_summs(model)
summ(model, robust = "HC1")
install.packages("sandwich")
summ(model, robust = "HC1")
plot_summs(model)
export_summs(model, robust = "HC1", scale = TRUE)
export_summs(model, robust = "HC1")
export_summs(model)
export_summs(model, coefs = c(
"Religious Identity" = "yourelig_1",
"Degree" = "degree",
"Gender" = "gender_1"))
export_summs(model, coefs = c(
"Religious Identity: None" = "yourelig_1No Religion",
"Religious Identity: Other" = "yourelig_1Other Religion",
"Religious Identity: Protestant" = "yourelig_1Protestant",
"Degree" = "degree",
"Men" = "gender_1Male"))
export_summs(model, coefs = c(
"Religious Identity: None" = "yourelig_1No Religion",
"Religious Identity: Other" = "yourelig_1Other Religion",
"Religious Identity: Protestant" = "yourelig_1Protestant",
"Degree" = "degree",
"Men" = "gender_1Male"), robust = "HC1")
export_summs(model,
coefs = c(
"Religious Identity: None" = "yourelig_1No Religion",
"Religious Identity: Other" = "yourelig_1Other Religion",
"Religious Identity: Protestant" = "yourelig_1Protestant",
"Degree" = "degree",
"Men" = "gender_1Male"),
robust = "HC1",
to.file = "pdf")
export_summs(model,
coefs = c(
"Religious Identity: None" = "yourelig_1No Religion",
"Religious Identity: Other" = "yourelig_1Other Religion",
"Religious Identity: Protestant" = "yourelig_1Protestant",
"Degree" = "degree",
"Men" = "gender_1Male"),
robust = "HC1",
to.file = "docx")
install.packages("officer")
export_summs(model,
coefs = c(
"Religious Identity: None" = "yourelig_1No Religion",
"Religious Identity: Other" = "yourelig_1Other Religion",
"Religious Identity: Protestant" = "yourelig_1Protestant",
"Degree" = "degree",
"Men" = "gender_1Male"),
robust = "HC1",
to.file = "docx")
install.packages("flextable")
export_summs(model,
coefs = c(
"Religious Identity: None" = "yourelig_1No Religion",
"Religious Identity: Other" = "yourelig_1Other Religion",
"Religious Identity: Protestant" = "yourelig_1Protestant",
"Degree" = "degree",
"Men" = "gender_1Male"),
robust = "HC1",
to.file = "docx")
export_summs(model,
coefs = c(
"Religious Identity: None" = "yourelig_1No Religion",
"Religious Identity: Other" = "yourelig_1Other Religion",
"Religious Identity: Protestant" = "yourelig_1Protestant",
"Degree" = "degree",
"Men" = "gender_1Male"),
robust = "HC1",
to.file = "docx",
file.name = "reg_table_ei_norm")
export_summs(model,
coefs = c(
"Religious Identity: None" = "yourelig_1No Religion",
"Religious Identity: Other" = "yourelig_1Other Religion",
"Religious Identity: Protestant" = "yourelig_1Protestant",
"Degree" = "degree",
"Men" = "gender_1Male"),
robust = "HC1",
to.file = "docx",
file.name = "reg_table_ei_norm.docx")
# Beeswarm plot in ggplot2
ggplot() +
geom_quasirandom(data = df_sim_avg_ei, aes(x = yourelig_1, y = percent, color = yourelig_1, shape = type), cex=2, width = .5) +
geom_point(data=df_observed_avg_ei, aes(x=yourelig_1, y=percent, shape = type),  cex=3)+
#scale_color_viridis(discrete=TRUE, option="viridis")+
scale_color_brewer(palette = "RdYlBu", guide = "none")+
xlab("Ego's Religion")+
ylab("Average EI Score")+
theme_minimal()+
scale_y_continuous(breaks = seq(-1, 1, by = .2), limits=c(-1,1))+
scale_shape_manual(values = c(18, 16))+
labs(shape = "Data Type",
title = "Average EI Scores in Observed vs Simulated Ego Networks")+
geom_hline(yintercept = 0)
# Beeswarm plot in ggplot2
ggplot() +
geom_quasirandom(data = df_sim_avg_ei, aes(x = yourelig_1, y = percent, color = yourelig_1, shape = type), cex=2, width = .5) +
geom_point(data=df_observed_avg_ei, aes(x=yourelig_1, y=percent, shape = type),  cex=3)+
#scale_color_viridis(discrete=TRUE, option="viridis")+
scale_color_brewer(palette = "RdYlBu", guide = "none")+
xlab("Ego's Religious Identity")+
ylab("Average EI Score")+
theme_minimal()+
scale_y_continuous(breaks = seq(-1, 1, by = .2), limits=c(-1,1))+
scale_shape_manual(values = c(18, 16))+
labs(shape = "Data Type",
title = "Average EI Scores in Observed vs Simulated Ego Networks")+
geom_hline(yintercept = 0)
-0.622 + 0.460
0.529 - 0.756
0.698 - 0.909
0.583 - 0.805
z_cath
z_none
z_other
z_prot
df_w3_comb_data$close
table(df_w3_comb_data$close)
df_w3_comb_data <- df_w3_comb_data %>%
mutate(especially_close =
case_when(
close == "EspeciallyClose" ~ 1,
TRUE ~ 0
))
table(df_w3_comb_data$especially_close)
model <- lm(especially_close ~ yourelig_1 + same_relig + (yourelig_1 * same_relig), df_w3_comb_data)
summary(model)
model <- lm(especially_close ~ yourelig_1 + same_relig, df_w3_comb_data)
summary(model)
table(df_w3_model_data$yourelig_1)
prop.table(table(df_w3_model_data$yourelig_1))
round(prop.table(table(df_w3_model_data$yourelig_1)),2)
round(100*prop.table(table(df_w3_model_data$yourelig_1)),2)
table(df_w3_model_data$gender_1)
round(100*prop.table(table(df_w3_model_data$gender_1)),2)
#alter religion
table(df_w3_comb_data$altrelig)
round(100*prop.table(table(df_w3_comb_data$altrelig)),2)
#alter gender
table(df_w3_comb_data$altsex)
round(100*prop.table(table(df_w3_comb_data$sex)),2)
round(100*prop.table(table(df_w3_comb_data$altsex)),2)
#EI
summary(df_w3_model_data$ei)
hist(df_w3_model_data$ei
hist(df_w3_model_data$ei)
hist(df_w3_model_data$ei)
summary(df_w3_model_data$ei_norm)
hist(df_w3_model_data$ei_norm)
x = rep(c(0,1),1000)
y = 17.53 + 4.36 * x + rnorm(x,0,0.87)
hist(y,n=50)  # bimodal
rm(x)
rm(y)
hist(df_w3_model_data$ei_norm)
#EI
mean(df_w3_model_data$ei)
sd(df_w3_model_data$ei)
round(sd(df_w3_model_data$ei),4)
#EI
round(mean(df_w3_model_data$ei),4)
round(mean(df_w3_model_data$ei_norm,4))
round(mean(df_w3_model_data$ei_norm),4)
round(mean(df_w3_model_data$ei_norm),4)
round(sd(df_w3_model_data$ei_norm),4)
df_w3_model_data %>%
group_by(yourelig_1) %>%
summarise_at(vars(ei_norm), list(name = mean)) %>%
round(4)
df_w3_model_data %>%
group_by(yourelig_1) %>%
summarise_at(vars(ei_norm), list(name = mean))
df_w3_model_data %>%
group_by(yourelig_1) %>%
summarise_at(vars(ei_norm), list(mean = mean, sd = sd))
#EI by religious identity
df_w3_model_data %>%
group_by(yourelig_1) %>%
summarise_at(vars(ei), list(mean = mean, sd = sd))
model <- lm(ei_norm ~ yourelig_1 + degree + gender_1, df_w3_model_data)
export_summs(model,
coefs = c(
"Religious Identity: None" = "yourelig_1No Religion",
"Religious Identity: Other" = "yourelig_1Other Religion",
"Religious Identity: Protestant" = "yourelig_1Protestant",
"Degree" = "degree",
"Men" = "gender_1Male"),
robust = "HC1",
to.file = "docx",
file.name = "reg_table_ei_norm.docx")
export_summs(model,
coefs = c(
"Religious Identity: None" = "yourelig_1No Religion",
"Religious Identity: Other" = "yourelig_1Other Religion",
"Religious Identity: Protestant" = "yourelig_1Protestant",
"Degree" = "degree",
"Men" = "gender_1Male"),
robust = "HC1")
model_ei_norm <- lm(ei_norm ~ yourelig_1 + degree + gender_1, df_w3_model_data)
model_ei <- lm(ei ~ yourelig_1 + degree + gender_1, df_w3_model_data)
export_summs(model_ei_norm, model_ei,
coefs = c(
"Religious Identity: None" = "yourelig_1No Religion",
"Religious Identity: Other" = "yourelig_1Other Religion",
"Religious Identity: Protestant" = "yourelig_1Protestant",
"Degree" = "degree",
"Men" = "gender_1Male"),
robust = "HC1")
export_summs(model_ei_norm, model_ei,
model.names = c("Model 1: EI", "Model 2: Normalized EI"),
coefs = c(
"Religious Identity: None" = "yourelig_1No Religion",
"Religious Identity: Other" = "yourelig_1Other Religion",
"Religious Identity: Protestant" = "yourelig_1Protestant",
"Degree" = "degree",
"Men" = "gender_1Male"),
robust = "HC1")
export_summs(model_ei, model_ei_norm
model.names = c("Model 1: EI", "Model 2: Normalized EI"),
export_summs(model_ei, model_ei_norm,
model.names = c("Model 1: EI", "Model 2: Normalized EI"),
coefs = c(
"Religious Identity: None" = "yourelig_1No Religion",
"Religious Identity: Other" = "yourelig_1Other Religion",
"Religious Identity: Protestant" = "yourelig_1Protestant",
"Degree" = "degree",
"Men" = "gender_1Male"),
robust = "HC1")
library(here)
library(readr)
library(dplyr)
# load ego network survey
df_netsurv <- read_csv(here('data', 'NetWorkSurvey(2-28-20).csv'))
# load basic survey
df_basicsurv <- read_csv(here('data', 'BasicSurvey(3-6-20).csv'))
# subset the network dataframes to W3
df_netsurv <- df_netsurv |>
filter(wave == 'Wave3')
df_w3_comb_data <- left_join(df_basicsurv, df_netsurv, by = 'egoid')
# filter out yourelig == NA
df_w3_comb_data <- df_w3_comb_data |>
filter(!is.na(yourelig_1))
# subset to on-campus ties
df_w3_comb_data <- df_w3_comb_data %>%
filter(altrelucat=="Student")
# impute missing alter relig in cases where
# 1) the alter was reported by multiple egos
# 2) at least one ego attributed a relig to that alter
# 3) only one other relig was attributed to that alter
# This preserves 108 ties from being deleted
df_w3_comb_data <- df_w3_comb_data %>%
mutate(dupe_alter=
duplicated(df_w3_comb_data["alterid"]))
df_alter_dupes <- df_w3_comb_data %>%
filter(dupe_alter == TRUE)
list_alter_dupes <- unique(df_alter_dupes$alterid)
df_alter_dupes <- df_w3_comb_data %>%
filter(alterid %in% list_alter_dupes)
df_alter_dupes <- df_alter_dupes %>%
group_by(alterid) %>%
mutate(n_rels = n_distinct(altrelig))
df_alter_dupes <- df_alter_dupes %>%
filter(n_rels == 2)
list_na_alter <- df_alter_dupes %>%
filter(is.na(altrelig))
list_na_alter <- list_na_alter$alterid
df_alter_dupes <- df_alter_dupes %>%
filter(alterid %in% list_na_alter)
df_alter_dupes <- df_alter_dupes %>%
group_by(alterid) %>%
mutate(altrelig = unique(altrelig[!is.na(altrelig)]))
df_imputed_alts <- df_alter_dupes %>%
select(alterid, altrelig)
df_imputed_alts <- distinct(df_imputed_alts)
df_imputed_alts <- rename(df_imputed_alts, altrelig_i = altrelig)
df_w3_comb_data <- left_join(df_w3_comb_data, df_imputed_alts, by = "alterid")
df_w3_comb_data$altrelig <- ifelse(is.na(df_w3_comb_data$altrelig), df_w3_comb_data$altrelig_i, df_w3_comb_data$altrelig)
rm(df_imputed_alts, df_alter_dupes, list_alter_dupes, list_na_alter)
# filter out altrelig == NA
df_w3_comb_data <- df_w3_comb_data |>
filter(!is.na(altrelig))
#change yourelig_1 to factor
df_w3_comb_data$yourelig_1 <- as.factor(df_w3_comb_data$yourelig_1)
# create same-relig variable
df_w3_comb_data <- df_w3_comb_data |>
mutate(
same_relig = case_when(
yourelig_1 == "Catholic" & altrelig == "Catholic" ~ 1,
yourelig_1 == "No Religion" & altrelig == "NoReligion" ~ 1,
yourelig_1 == "Other Religion" & altrelig == "OtherReligion" ~ 1,
yourelig_1 == "Protestant" & altrelig == "Protestant" ~ 1,
TRUE ~ 0
))
# count the number of same-relig alters
df_w3_comb_data <- df_w3_comb_data |>
group_by(egoid) %>%
mutate(n_samerelig = sum(same_relig == 1))
#count the degree
df_w3_comb_data <- df_w3_comb_data |>
group_by(egoid) %>%
mutate(degree = n())
# count the number of diff-relig alters
df_w3_comb_data <- df_w3_comb_data |>
group_by(egoid) %>%
mutate(n_diffrelig = degree-n_samerelig)
# calculate EI Index
df_w3_comb_data <- df_w3_comb_data |>
group_by(egoid) |>
mutate(ei = (n_diffrelig-n_samerelig)/(degree))
#create vars for the denominators
table(df_basicsurv$yourelig_1)
e_cath <- 89+33+71
i_cath <- 525-1
e_none <- 525+33+71
i_none <- 89-1
e_other<- 525+89+71
i_other<- 33-1
e_prot <- 525+89+33
i_prot <- 71-1
df_w3_comb_data <- df_w3_comb_data %>%
mutate(
e_denominator = case_when(
yourelig_1 == "Catholic" ~ e_cath,
yourelig_1 == "No Religion" ~ e_none,
yourelig_1 == "Other Religion" ~ e_other,
yourelig_1 == "Protestant" ~ e_prot,
TRUE ~ 0
))
df_w3_comb_data <- df_w3_comb_data %>%
mutate(
i_denominator = case_when(
yourelig_1 == "Catholic" ~ i_cath,
yourelig_1 == "No Religion" ~ i_none,
yourelig_1 == "Other Religion" ~ i_other,
yourelig_1 == "Protestant" ~ i_prot,
TRUE ~ 0
))
# calculate normalized EI Index
df_w3_comb_data <- df_w3_comb_data |>
group_by(egoid) |>
mutate(ei_norm =
((n_diffrelig/e_denominator)-(n_samerelig/i_denominator))/((n_diffrelig/e_denominator)+(n_samerelig/i_denominator)))
df_w3_model_data <- df_w3_comb_data |>
select(egoid, yourelig_1, degree, ei, ei_norm, n_samerelig, gender_1, race_1)
df_w3_model_data <- distinct(df_w3_model_data)
df_observed_avg_ei <- df_w3_model_data %>%
group_by(yourelig_1) %>%
summarise_at(vars(ei), list(name = mean))
df_observed_avg_ei <-  rename(df_observed_avg_ei, percent = name)
library(tidyr)
library(ggplot2)
library(ggbeeswarm)
#load data if not already in memory
df_sim_avg_ei <- readRDS(here('data', 'df_sim_avg_ei_500.RDS'))
for (i in 2:501){
colnames(df_sim_avg_ei)[i] <- paste0(names(df_sim_avg_ei[i]),"_",i-1)
}
#reshape to long
df_sim_avg_ei <- gather(df_sim_avg_ei, key = sim_num, value = percent, -yourelig_1)
#add column for type
df_sim_avg_ei$type <- "Simulated"
df_observed_avg_ei$type <- "Observed"
# Beeswarm plot in ggplot2
ggplot() +
geom_quasirandom(data = df_sim_avg_ei, aes(x = yourelig_1, y = percent, color = yourelig_1, shape = type), cex=2, width = .5) +
geom_point(data=df_observed_avg_ei, aes(x=yourelig_1, y=percent, shape = type),  cex=3)+
scale_color_brewer(palette = "RdYlBu", guide = "none")+
xlab("Ego's Religious Identity")+
ylab("Average EI Score")+
theme_minimal()+
scale_y_continuous(breaks = seq(-1, 1, by = .2), limits=c(-1,1))+
scale_shape_manual(values = c(18, 16))+
labs(shape = "Data Type",
title = "Average EI Scores in Observed vs Simulated Ego Networks")+
geom_hline(yintercept = 0)
ggsave(path = here('plot.png'), width = 800, height = 500, device='png', dpi=300)
ggsave(path = here(,'plot.png'), width = 800, height = 500, device='png', dpi=300)
ggsave(path = here('data','plot.png'), width = 800, height = 500, device='png', dpi=300)
ggsave('plot.png', width = 800, height = 500, device='png', dpi=300)
ggsave("plot.png",
width = 800,
height = 500,
units = "px",
device= "png",
dpi=300)
ggsave("plot.png",
width = 6.5,
height = 5,
units = "in",
device= "png",
dpi=300)
ggsave("plot.jpg",
width = 6.5,
height = 5,
units = "in",
device= "jpg",
dpi=300)
# Beeswarm plot in ggplot2
ggplot() +
geom_quasirandom(data = df_sim_avg_ei, aes(x = yourelig_1, y = percent, color = yourelig_1, shape = type), cex=2, width = .5) +
geom_point(data=df_observed_avg_ei, aes(x=yourelig_1, y=percent, shape = type),  cex=3)+
scale_color_brewer(palette = "RdYlBu", guide = "none")+
xlab("\nEgo's Religious Identity")+
ylab("Average EI Score")+
theme_minimal()+
scale_y_continuous(breaks = seq(-1, 1, by = .2), limits=c(-1,1))+
scale_shape_manual(values = c(18, 16))+
labs(shape = "Data Type",
title = "Average EI Scores in Observed vs Simulated Ego Networks\n")+
geom_hline(yintercept = 0)
ggsave("plot.jpg",
width = 6.5,
height = 5,
units = "in",
device= "jpg",
dpi=300)
# Beeswarm plot in ggplot2
ggplot() +
geom_quasirandom(data = df_sim_avg_ei, aes(x = yourelig_1, y = percent, color = yourelig_1, shape = type), cex=1, width = .5) +
geom_point(data=df_observed_avg_ei, aes(x=yourelig_1, y=percent, shape = type),  cex=3)+
scale_color_brewer(palette = "RdYlBu", guide = "none")+
xlab("\nEgo's Religious Identity")+
ylab("Average EI Score")+
theme_minimal()+
scale_y_continuous(breaks = seq(-1, 1, by = .2), limits=c(-1,1))+
scale_shape_manual(values = c(18, 16))+
labs(shape = "Data Type",
title = "Average EI Scores in Observed vs Simulated Ego Networks\n")+
geom_hline(yintercept = 0)
# Beeswarm plot in ggplot2
ggplot() +
geom_quasirandom(data = df_sim_avg_ei, aes(x = yourelig_1, y = percent, color = yourelig_1, shape = type), cex=1, width = .5) +
geom_point(data=df_observed_avg_ei, aes(x=yourelig_1, y=percent, shape = type),  cex=3)+
scale_color_brewer(palette = "RdYlBu", guide = "none")+
xlab("Ego's Religious Identity")+
ylab("Average EI Score")+
theme_minimal()+
scale_y_continuous(breaks = seq(-1, 1, by = .2), limits=c(-1,1))+
scale_shape_manual(values = c(18, 16))+
labs(shape = "Data Type",
title = "Average EI Scores in Observed vs Simulated Ego Networks\n")+
geom_hline(yintercept = 0)
ggsave("plot.jpg",
width = 6.5,
height = 5,
units = "in",
device= "jpg",
dpi=300)
# Beeswarm plot in ggplot2
ggplot() +
geom_quasirandom(data = df_sim_avg_ei, aes(x = yourelig_1, y = percent, color = yourelig_1, shape = type), cex=1, width = .5) +
geom_point(data=df_observed_avg_ei, aes(x=yourelig_1, y=percent, shape = type),  cex=2)+
scale_color_brewer(palette = "RdYlBu", guide = "none")+
xlab("Ego's Religious Identity")+
ylab("Average EI Score")+
theme_minimal()+
scale_y_continuous(breaks = seq(-1, 1, by = .2), limits=c(-1,1))+
scale_shape_manual(values = c(18, 16))+
labs(shape = "Data Type",
title = "Average EI Scores in Observed vs Simulated Ego Networks\n")+
geom_hline(yintercept = 0)
ggsave("plot.jpg",
width = 6.5,
height = 5,
units = "in",
device= "jpg",
dpi=300)
ggsave("plot.jpg",
width = 6.5,
height = 5,
units = "in",
device= "jpg",
dpi=700)
# Beeswarm plot in ggplot2
ggplot() +
geom_quasirandom(data = df_sim_avg_ei, aes(x = yourelig_1, y = percent, color = yourelig_1, shape = type), cex=1, width = .5) +
geom_point(data=df_observed_avg_ei, aes(x=yourelig_1, y=percent, shape = type),  cex=2)+
scale_color_brewer(palette = "RdYlBu", guide = "none")+
xlab("\nEgo's Religious Identity")+
ylab("Average EI Score")+
theme_minimal()+
scale_y_continuous(breaks = seq(-1, 1, by = .2), limits=c(-1,1))+
scale_shape_manual(values = c(18, 16))+
labs(shape = "Data Type",
title = "Average EI Scores in Observed vs Simulated Ego Networks\n")+
geom_hline(yintercept = 0)
ggsave("plot.jpg",
width = 6.5,
height = 5,
units = "in",
device= "jpg",
dpi=700)
